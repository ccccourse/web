### **19. 網站性能優化**

網站性能優化對於提升用戶體驗、加快加載速度以及改善SEO排名至關重要。前端性能優化涵蓋了多個方面，包括圖片壓縮、CSS 和 JS 合併、延遲加載等。

---

### **1. 圖片壓縮與優化**

圖片是網站中佔用最大帶寬的元素之一。優化圖片可以顯著提升頁面加載速度。

#### **圖片壓縮**
圖片壓縮可以減少圖片的檔案大小，從而加快頁面加載速度。常見的圖片壓縮方法包括：
- **無損壓縮**：保持圖片的質量，僅減少冗餘資料。
- **有損壓縮**：通過降低圖片質量來達到更高的壓縮比，但可能會影響視覺效果。

常見的圖片壓縮工具：
- **ImageOptim**（Mac）：針對圖片進行壓縮和優化。
- **TinyPNG**：在線壓縮 PNG 和 JPEG 格式圖片。
- **Squoosh**：Google 開發的圖片壓縮工具，支持多種格式。

#### **圖片格式選擇**
選擇適合的圖片格式也能提升性能：
- **JPEG**：適用於色彩豐富的圖片，如照片。
- **PNG**：適用於透明背景圖片，且支持無損壓縮。
- **WebP**：現代圖片格式，支持高效壓縮且保持高質量，是目前最推薦的圖片格式。

#### **圖片尺寸**
根據頁面的需求，合理調整圖片的尺寸，避免加載過大的圖片。可以使用 CSS 和 HTML 中的 `srcset` 屬性根據設備屏幕尺寸來加載不同大小的圖片。

```html
<img src="image-800w.jpg" 
     srcset="image-400w.jpg 400w, image-800w.jpg 800w, image-1200w.jpg 1200w" 
     alt="Example image">
```

#### **延遲加載圖片**
延遲加載（Lazy Loading）技術能夠推遲加載不在可視範圍內的圖片，直到用戶滾動到該區域才加載圖片，從而減少初次加載的資源量。

```html
<img src="placeholder.jpg" data-src="image.jpg" class="lazyload" alt="Lazy load image">
```
使用 JavaScript 庫（如 **lazysizes**）來實現圖片的延遲加載。

---

### **2. CSS 和 JS 合併**

合併 CSS 和 JavaScript 文件是減少網頁請求數量的有效方法，從而提高頁面加載速度。

#### **CSS 和 JS 合併**
通過將多個 CSS 和 JavaScript 文件合併為單個文件，可以減少 HTTP 請求的數量。這對於減少網絡延遲和提高加載速度非常有效。

- **CSS 合併**：將所有樣式表文件合併為一個文件，避免多次加載樣式表。
- **JS 合併**：將所有 JavaScript 文件合併為一個文件，避免多次加載腳本。

#### **工具和插件**
可以使用以下工具來自動合併和壓縮 CSS 和 JS 文件：
- **Webpack**：用於打包和優化靜態資源的工具，支持 CSS 和 JS 文件的合併和壓縮。
- **Parcel**：自動化打包工具，支持即時編譯和優化。
- **Gulp**：自動化構建工具，支持將文件合併並進行壓縮。
- **Terser**：JavaScript 代碼壓縮工具，用來壓縮和優化 JS 代碼。

#### **按需加載（Code Splitting）**
如果你的應用非常大，合併所有的 CSS 和 JS 可能會導致初始加載過慢。在這種情況下，可以使用 **按需加載** 或 **代碼分割**（Code Splitting），根據用戶需求分批加載 JavaScript 文件。Webpack 和 Parcel 都支持這一功能。

```javascript
import("./module").then(module => {
  // 使用 module
});
```

---

### **3. 延遲加載（Lazy Loading）**

延遲加載是指當頁面初始加載完成後，僅加載頁面上用戶可見的部分，並在用戶滾動或進行交互時加載剩餘的內容。這對於減少網頁的初始加載時間非常有效。

#### **延遲加載的實現**
- **圖片延遲加載**：正如前面提到的，可以使用 `data-src` 屬性和 JavaScript 庫（如 **lazysizes**）來實現圖片的延遲加載。
- **JavaScript 延遲加載**：可以利用 `async` 和 `defer` 屬性來延遲加載 JavaScript 腳本。

  - **`async`**：使 JavaScript 文件異步加載，不會阻塞頁面的渲染。
  - **`defer`**：使 JavaScript 文件延遲執行，直到 HTML 文件解析完成。

```html
<script src="script.js" async></script>
<script src="script.js" defer></script>
```

- **懶加載 iframe**：為了提高性能，可以將 iframe 的加載延遲至需要顯示時。

```html
<iframe src="example.html" loading="lazy"></iframe>
```

---

### **4. 使用 CDN 加速靜態資源**

CDN（Content Delivery Network）可以將靜態資源（如圖片、CSS、JavaScript 文件）分發到全球的多個伺服器上，根據用戶的地理位置選擇最接近的伺服器進行加載，從而減少加載延遲並提高性能。

常見的 CDN 提供商：
- **Cloudflare**
- **AWS CloudFront**
- **Fastly**

通過將靜態資源部署到 CDN 上，能夠顯著提高頁面的加載速度，特別是對於分佈在不同地區的用戶。

---

### **5. 使用 HTTP/2 或 HTTP/3**

HTTP/2 和 HTTP/3 是比 HTTP/1 更先進的協議，能夠顯著提高網頁加載速度。HTTP/2 支持多路復用，允許多個請求同時在一個連接中傳輸，減少延遲。

#### **優勢**：
- **多路復用**：在同一連接上並行處理多個請求，減少開銷。
- **服務端推送**：可以提前將資源推送給客戶端，提前準備好頁面所需的資源。
- **Header 压缩**：減少重複信息的傳輸，節省帶寬。

#### **啟用 HTTP/2**
許多現代的 web 伺服器（如 Nginx、Apache、Caddy 等）都支持 HTTP/2。要啟用 HTTP/2，只需要確保使用 TLS（HTTPS），並且在伺服器上啟用對應的支持。

---

### **總結**

網站性能優化是一個多層次的過程，從圖片壓縮、CSS 和 JS 文件的合併與延遲加載，到更高級的技術，如使用 CDN 和 HTTP/2 協議，都能有效提高頁面的加載速度。這些優化措施有助於提升用戶體驗、降低跳出率，並提高搜尋引擎排名。